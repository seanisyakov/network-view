<!DOCTYPE html>

<meta charset="utf-8">
<style>
table, th {
    border: 1px solid black;
}

table, td{
	border: 0.5px solid black;
}

.sidenav {
    height: 100%;
    width: 0;
    position: fixed;
    z-index: 1;
    top: 0;
    left: 0;
    background-color: #111;
    overflow-x: hidden;
    padding-top: 60px;
}

.sidenav a {
    padding: 8px 8px 8px 32px;
    text-decoration: none;
    font-size: 25px;
    color: #818181;
    display: block;
}

.sidenav a:hover, .offcanvas a:focus{
    color: #f1f1f1;
}

.closebtn {
    position: absolute;
    top: 0;
    right: 25px;
    font-size: 36px !important;
    margin-left: 50px;
}

#main {
    padding: 16px;
}

#a2 {
	background-color: #008CBA;
	color: white;
}

#a3 {
	background-color: #008CBA;
	color: white;
}

#topTr{
	width: 30px;
}

@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}

.button {
    background-color: #008CBA;
    border: none;
    border-radius : 8px;
    color: white;
    padding: 10px 90px;
    text-align: left;
    text-decoration: none;
    display: inline-block;
    margin: 1px 1px;
    cursor: pointer;
}

.disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

</style>

<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Table Test</title>
        <!--<script type="text/javascript" src="d3/d3.js"></script>-->
        <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>-->
        <script src = "non_comparison2_copy.js"></script>
    </head>
    <body>

    <div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
  	<div id = "innerNav">
  	</div>

</div>

	<div id="main">
 
	<table id = "myTable">
	<tr id = "myTr">
	</tr>
	</table>

    </div>

    <script>

function makeDateMap(){
    var releaseDateMap = new Map();
    releaseDateMap.set("Nikon D3300", 2014);
    releaseDateMap.set("Canon EOS 70D", 2013);
    releaseDateMap.set("Sony HX-300", 2013);
    releaseDateMap.set("Canon EOS Rebel Sl1", 2013);
    releaseDateMap.set("Canon EOS Rebel T5i", 2013);
    releaseDateMap.set("Canon EOS Rebel T4i", 2012);
    releaseDateMap.set("Canon EOS 60D", 2010);
    releaseDateMap.set("Canon EOS 7D", 2009);
    releaseDateMap.set("Nikon D90", 2008);
    releaseDateMap.set("Nikon D7000", 2008);
    releaseDateMap.set("Nikon D80", 2006);
    releaseDateMap.set("Canon EOS 6D", 2012);
    releaseDateMap.set("Nikon D3200", 2012);
    releaseDateMap.set("Nikon D5200", 2013);
    releaseDateMap.set("Canon EOS Rebel SL1", 2013);
    releaseDateMap.set("Canon EOS Rebel T3i", 2011);
    releaseDateMap.set("Canon SX 40", 2011);
    releaseDateMap.set("Pentax K30", 2012);
    releaseDateMap.set("Nikon D5100", 2011);
    releaseDateMap.set("Nikon D800E", 2012);
    releaseDateMap.set("Nikon D7100", 2013);
    releaseDateMap.set("Nikon D3100", 2010);
    releaseDateMap.set("Nikon D70", 2008);
    releaseDateMap.set("Canon EOS Rebel T2i", 2010);
    releaseDateMap.set("Canon EOS 50D", 2008);
    releaseDateMap.set("Canon EOS 5D Mk III", 2012);
    releaseDateMap.set("Canon EOS 7D II", 2014);
    releaseDateMap.set("Canon EOS Rebel T1i", 2009);
    releaseDateMap.set("Nikon D300", 2007);
    releaseDateMap.set("Nikon D600", 2012);
    releaseDateMap.set("Nikon D800", 2012);
    releaseDateMap.set("Nikon D60", 2008);
    releaseDateMap.set("Canon EOS D70", 2013);
    releaseDateMap.set("Canon EOS 80D", 2016);
    releaseDateMap.set("Sony Alpha a6300", 2016);
    releaseDateMap.set("Nikon D7200", 2015);
    releaseDateMap.set("Samsung NX1", 2010);
    releaseDateMap.set("Canon 5D Mk III", 2012);
    releaseDateMap.set("Canon EOS 7D Mk II", 2014);
    releaseDateMap.set("Olympus Evolt E500", 2005);
    releaseDateMap.set("Canon EOS Rebel XSi", 2008);
    releaseDateMap.set("Nikon D750", 2014);
    releaseDateMap.set("Nikon D610", 2013);
    releaseDateMap.set("Nikon D700", 2008);
    releaseDateMap.set("Nikon D4", 2012);
    releaseDateMap.set("Nikon Df", 2013);
    releaseDateMap.set("Nikon D810", 2014);
    releaseDateMap.set("Sony a6000", 2014);
    releaseDateMap.set("Sony Alpha a7II", 2014);
    releaseDateMap.set("Sony Alpha a7s", 2013);
    releaseDateMap.set("Nikon D300S", 2009);
    releaseDateMap.set("Sony Alpha SLT-A99V", 2012);
    releaseDateMap.set("Canon EOS 40D", 2007);
    releaseDateMap.set("Nikon D5300", 2013);
    return releaseDateMap;
}

function makePriceMap(){
  var priceMap = new Map();
  priceMap.set("Nikon D3300", 546.95);
  priceMap.set("Canon EOS 70D", 999);
  priceMap.set("Sony HX-300", 300);
  priceMap.set("Canon EOS Rebel SL1", 400);
  priceMap.set("Canon EOS Rebel T5i", 500);
  priceMap.set("Canon EOS Rebel T4i", 480);
  priceMap.set("Canon EOS 60D", 659);
  priceMap.set("Canon EOS 7D", 1500);
  priceMap.set("Nikon D90", 1000);
  priceMap.set("Nikon D7000", 500);
  priceMap.set("Nikon D80", 900);
  priceMap.set("Canon EOS 6D", 1200);
  priceMap.set("Nikon D3200", 900);
  priceMap.set("Nikon D5200", 900);
  priceMap.set("Canon EOS Rebel SL1", 900);
  priceMap.set("Canon EOS Rebel T3i", 900);
  priceMap.set("Canon SX 40", 900);
  priceMap.set("Pentax K30", 900);
  priceMap.set("Nikon D5100", 650);
  priceMap.set("Nikon D800E", 1600);
  priceMap.set("Nikon D7100", 900);
  priceMap.set("Nikon D3100", 700);
  priceMap.set("Nikon D70", 2000);
  priceMap.set("Canon EOS Rebel T2i", 300);
  priceMap.set("Canon EOS 50D", 1500);
  priceMap.set("Canon EOS 5D Mk III", 2600);
  priceMap.set("Canon EOS 7D II", 1800);
  priceMap.set("Canon EOS Rebel T1i", 200);
  priceMap.set("Nikon D300", 500);
  priceMap.set("Nikon D600", 1300);
  priceMap.set("Nikon D800", 1500);
  priceMap.set("Nikon D60", 650);
  priceMap.set("Canon EOS D70", 1000);
  priceMap.set("Canon EOS 80D", 1200);
  priceMap.set("Sony Alpha a6300", 1000);
  priceMap.set("Nikon D7200", 2000);
  priceMap.set("Samsung NX1", 2250);
  priceMap.set("Canon 5D Mk III", 2600);
  priceMap.set("Canon EOS 7D Mk II", 1800);
  priceMap.set("Olympus Evolt E500", 170);
  priceMap.set("Canon EOS Rebel XSi", 275);
  priceMap.set("Nikon D750", 2000);
  priceMap.set("Nikon D610", 1500);
  priceMap.set("Nikon D700", 850);
  priceMap.set("Nikon D4", 2800);
  priceMap.set("Nikon Df", 3000);
  priceMap.set("Nikon D810", 3200);
  priceMap.set("Sony a6000", 550);
  priceMap.set("Sony Alpha a7II", 1680);
  priceMap.set("Sony Alpha a7s", 2100);
  priceMap.set("Nikon D300S", 900);
  priceMap.set("Sony Alpha SLT-A99V", 2000);
  priceMap.set("Canon EOS 40D", 1100);
  priceMap.set("Nikon D5300", 600);
  return priceMap;
}

function createText2(map){
    var i = 0;
    var ar = [];
    map.forEach(function(value, key){
        value.sort(function(a, b){
        if (a[0] == "✔" && (b[0] == "○" || b[0] == "✘")){
            return -1;
        }else{
            if (a[0] == "○" && b[0] == "✘"){
                return -1;
            }else{
                if (a[0] == "○" && b[0] == "✔"){
                    return 1;
                }else{
                    if (a[0] == "✘") return 1;
                }
            }
        }

        });
        var ok = [];
        for (var j = 0; j < value.length; j++){
            ok.push(value[j][1]);
        }
        ar[i] = ok;
        i++
    });

    return ar;

}

function createText(map){
    var i = 0;
    var ar = [];
    map.forEach(function(value, key){
        value.sort(function(a, b){
        if (a[0] == "✔" && (b[0] == "○" || b[0] == "✘")){
            return -1;
        }else{
            if (a[0] == "○" && b[0] == "✘"){
                return -1;
            }else{
                if (a[0] == "○" && b[0] == "✔"){
                    return 1;
                }else{
                    if (a[0] == "✘") return 1;
                }
            }
        }

        });
        var ok = [];
        for (var j = 0; j < value.length; j++){
            ok.push(value[j][0]);
        }
        ar[i] = key + " : " + ok.toString();
        i++
    });

    return ar;

}


function openNav(map, indexes) {
    document.getElementById("mySidenav").style.width = "375px";
    document.getElementById("main").style.marginLeft = "375px";
    
    var y2 = document.createElement("a");
    y2.setAttribute("id", "a2");
    var t2 = document.createTextNode(iMatrix[0][indexes[2]] + " ($" + priceMap.get(iMatrix[0][indexes[2]]) + ")");
    y2.appendChild(t2);
    document.getElementById("innerNav").appendChild(y2);

    var txt = createText(map);
    txt.forEach(function(ele){  
        var y = document.createElement("a");
        y.setAttribute("id", "a1");
        var t = document.createTextNode(ele);
        y.appendChild(t);
    document.getElementById("innerNav").appendChild(y);
    });

}

function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
    document.getElementById("main").style.marginLeft= "0";
}

function writeStuff(window2, map, indexes){
    window2.document.write("<style>.tooltip {position: relative; display: inline-block; border-bottom: 1px dotted black;}.tooltip .tooltiptext {visibility: hidden; width: 320px; background-color: black; color: #fff; text-align: center; border-radius: 6px; padding: 5px 0; position: absolute; z-index: 1; top: 100%; left: 150%; margin-left: -60px;}.tooltip:hover .tooltiptext {visibility: visible;}</style>");
                
    //window2.document.writeln("<div class='tooltip'>Hover over me<span class='tooltiptext'>Tooltip text</span></div>");

    window2.document.writeln("<div>" + iMatrix[0][indexes[2]] + "</div>");
    var t = createText(map);
    var rt = createText2(map);
    var j = 0;
    
    t.forEach(function(ele){
        var ss = ele.split(",");
        for (var i = 0; i < ss.length; i++){
            window2.document.write("<div class='tooltip'>" + ss[i] + "<span class='tooltiptext'>" + rt[j][i] + "</span>" + "</div>");
        }
        window2.document.write("<p>");
        j++;
    });
}

var priceMap = makePriceMap();
var dateMap = makeDateMap();
addRowHeaders();
var c = addColHeaders(data);
var iMatrix = setMatrix(c);
var indexMap = createIndexMap(iMatrix);
buildMatrix(iMatrix, data);
insertCells(iMatrix);
addPopToCells();
sortArrays();
changeArrays(iMatrix);

function sortArrays(){
    for (var i = 1; i < iMatrix.length; i++){
        for (var j = 1; j < iMatrix[0].length; j++){
            var ele = iMatrix[i][j];
            
            if (ele !== undefined){
                var mapAsc = new Map([...ele.entries()].sort(function(a,b){
                    var totala = a[1].reduce(function(a, b) {
                          return a + b[0];
                        }, 0);
                    var totalb = b[1].reduce(function(a, b) {
                          return a+ b[0];
                        }, 0);

                    if (a[1].length > b[1].length){
                        return -1;
                    }else{
                        if(a[1].length < b[1].length){
                            return 1;
                        }else{

                    if (totala > totalb){
                        return -1;
                    }else{
                        if (totala < totalb){
                            return 1;
                        }else{
                            return 0;
                        }
                    }
                }
            }
                }));
                iMatrix[i][j] = mapAsc;

}
}
}
}

function changeArrays(matrix){
    for (var i = 1; i < matrix.length; i++){
        for (var j = 1; j < matrix[0].length; j++){
            var ele = matrix[i][j];
            
            if (ele !== undefined){
                for (var value of ele.values()){
                    for (var k = 0; k < value.length; k++){
                        if (value[k][0] == "1"){
                            value[k][0] = "✔";
                        }else{
                            if (value[k][0] == "0"){
                                value[k][0] = "○";
                            }else{
                                if (value[k][0] == "-1"){
                                    value[k][0] = "✘";
                                }
                            }
                        }
                    }

                }

            }
        }
    }


}


function addPopToCells(){
    var buttons = document.getElementsByTagName("input");
    var buttonsCount = buttons.length;
    for (var i = 0; i < buttonsCount; i++) {
        if (buttons[i].className !== "button disabled"){
            buttons[i].onmouseenter = function(e) {
            
                var nameID = this.id;
                var splt = nameID.split(" ");
                var open = iMatrix[splt[1]][splt[2]];

                openNav(open, splt);
            }

            buttons[i].onmouseleave = function(){
                var clear = document.getElementById("innerNav");
                while(clear.firstChild){
                clear.removeChild(clear.firstChild);
            }

            }

            buttons[i].onclick = function(){

                var nameID2 = this.id;
                var splt2 = nameID2.split(" ");
                var open2 = iMatrix[splt2[1]][splt2[2]];
                var myWindow = window.open("", "MsgWindow", "width=1250,height=2000");
                writeStuff(myWindow, open2, splt2);
                
            }


        }
}
}



function insertCells(matrix){

    for (var i = 1; i < matrix.length; i++){
        var row = document.getElementById("myTr" + i);
        for (var j = 1; j < matrix[0].length; j++){
            var x = row.insertCell(-1);
            var btn = document.createElement('input');
            btn.id = "btn" + " " + i + " " + j;
            btn.type = "button";
            
            if (matrix[i][j] !== undefined){
                btn.className = "button";
            }else{
                btn.className = "button disabled";
            }
            x.appendChild(btn);

        }
    }
}

function toNum(string){
    if (string == "good"){
        return 1;
    }else{
        if (string == "neutral"){
            return 0;
        }else{
            if (string == "bad"){
                return -1;
            }
        }
    }
}

function buildMatrix(matrix, obj){
    var cams = obj.cameras;
    for (var i = 0; i < cams.length; i++){
        var it = cams[i];
        var y = indexMap.get(it.item);
        var qual = toNum(it.value);
        var txt = it.text;
        if (matrix[1][y] == undefined){
            var n = new Map();
            n.set(it.dimension, [[qual, txt]]);
            matrix[1][y] = n;
        }else{
            if (matrix[1][y].has(it.dimension)){
                var arr = matrix[1][y].get(it.dimension);
                arr.push([qual, txt]);
                matrix[1][y].set(it.dimension, arr);
            }else{
                matrix[1][y].set(it.dimension, [[qual, txt]]);
            }
             
            
        }

}

}

function createIndexMap(matrix){

    var map = new Map();
    for (var i = 1; i < matrix[0].length; i++){
        map.set(matrix[0][i], i);
    }


    return map;

}

function setMatrix(cameras){
    var camLength = cameras.length + 1;
    var camMatrix = new Array(2);
    for (var i = 0; i < 2; i++){
        camMatrix[i] = new Array(camLength);
    }   
    for (var k = 1; k < camMatrix[0].length; k++){
        camMatrix[0][k] = cameras[k-1];
    }
    return camMatrix;

}


function addRowHeaders(){
    var table = document.getElementById("myTable");
    var row = table.insertRow(1);
        row.setAttribute("id", "myTr" + 1);

    var x = document.createElement("TH");
    var t = document.createTextNode("");
    x.appendChild(t);
    document.getElementById("myTr" + 1).appendChild(x);


}

function addColHeaders(obj){
    var camCount = countCam(obj);
    var camArray = new Array();
    bySortedValue(camCount, function(key,value){camArray.push(key);});
    var x = document.createElement("TH");
    document.getElementById("myTr").appendChild(x);
    camArray.forEach(function(camera){
        var x = document.createElement("TH");
        var t = document.createTextNode(camera + " (" + dateMap.get(camera) + ")");
        x.appendChild(t);
        document.getElementById("myTr").appendChild(x);
    });

    return camArray;

}

function countCam(obj){

var camCounter = new Map();
var allCam = obj.cameras;

for (var i = 0; i < allCam.length; i++){
var camInfo = allCam[i];

if (!(camCounter.has(camInfo["item"]))){
camCounter.set(camInfo["item"], 1);
}else{
    var update = camCounter.get(camInfo["item"]);
    update++;
    camCounter.set(camInfo["item"], update);
}
}
return camCounter;
}

function bySortedValue(obj, callback, context) {
    var tuples = [];

    for (var [key, value] of obj){
        
        tuples.push([key, value]);
    }


    tuples.sort(function(a, b) { return a[1] > b[1] ? 1 : a[1] < b[1] ? -1 : 0 });

    var length = tuples.length;
    while (length--) callback.call(context, tuples[length][0], tuples[length][1]);
}




    </script>
    </body>
</html>